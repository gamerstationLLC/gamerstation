name: Pokemon Catch Data (Build + Blob Upload)

on:
  workflow_dispatch:
  schedule:
    - cron: "23 10 * * 1" # Mondays 10:23 UTC (change whenever)

concurrency:
  group: pokemon-catch-data
  cancel-in-progress: false

jobs:
  build_and_upload:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      - name: Install
        run: npm ci

      # You said: jobs that call external APIs should NEVER fail the job
      - name: Build Pokemon catch datasets
        continue-on-error: true
        run: npx tsx scripts/pokemon/build-catch-data.ts

      - name: Upload Pokemon datasets to Blob
        if: always()
        env:
          BLOB_READ_WRITE_TOKEN: ${{ secrets.BLOB_READ_WRITE_TOKEN }}
          BLOB_UPLOAD_DIRS: public/data/pokemon
          BLOB_FORCE_OVERWRITE: "1"
          BLOB_CACHE_SECONDS: "300"
        run: node scripts/blob/upload-data.mjs
